<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <title>Seating Chart</title>
    <style>
        .seat {
            width: 200px;
            height: 50px;
            margin: 5px;
            display: inline-block;
            text-align: center;
            vertical-align: middle;
            line-height: 50px;
            cursor: pointer;
            position: relative;
        }
        .occupied {
            background-color: red;
            color: white;
        }
        .available {
            background-color: lightgray;
        }
        .selecting {
            background-color: yellow;
        }
        .clear-button {
            position: absolute;
            top: 0;
            right: 0;
            background-color: white;
            border: none;
            cursor: pointer;
            padding: 2px 5px;
        }
    </style>
</head>
<body>
    <h1>Seating Chart</h1>
    <form th:action="@{/updateSeats}" method="post">
        <div th:each="seat : ${seatListData}">
            <div
                 th:id="'seat-' + ${seat.floorSeatSeq}"
                 class="seat"
                 th:classappend="${seat.employee != null ? 'occupied' : 'available'}"
                 th:data-floor-seat-seq="${seat.floorSeatSeq}">
                <span th:text="${seat.floorNo + ':s' + seat.seatNo + (seat.employee != null ? ' [員編:' + seat.employee.empId + ']' : '')}"></span>
                <button type="button" class="clear-button" th:if="${seat.employee != null}" th:onclick="'clearSeat(' + ${seat.floorSeatSeq} + ')'">清除</button>
            </div>
        </div>

        <div>
            <label for="employeeSelect">選擇員工:</label>
            <select id="employeeSelect" name="employeeId">
                <option value="">選擇員工</option>
                <option th:each="employee : ${employeeList}" th:value="${employee.empId}" th:text="${employee.empId + ' - ' + employee.name}"></option>
            </select>
        </div>

        <!-- Hidden inputs to store selected seat ID and seat ID to clear -->
        <input type="hidden" id="selectedSeatId" name="selectedSeatId" />
        <input type="hidden" id="clearSeatId" name="clearSeatId" />

        <button type="submit">送出</button>
    </form>

    <script>
        let selectedSeat = null;

        function updateSeat(seatId) {
            const seatElement = document.getElementById('seat-' + seatId);
            if (selectedSeat) {
                // Clear previous selection
                selectedSeat.classList.remove('selecting');
            }
            if (seatElement.classList.contains('occupied')) {
                // Handle occupied seat
                return;
            }
            if (seatElement.classList.contains('selecting')) {
                // Deselect the seat
                seatElement.classList.remove('selecting');
                selectedSeat = null;
                document.getElementById('selectedSeatId').value = '';
            } else {
                // Select the seat
                seatElement.classList.add('selecting');
                selectedSeat = seatElement;
                document.getElementById('selectedSeatId').value = seatId;
            }
        }

        function clearSeat(seatId) {
            document.getElementById('clearSeatId').value = seatId;
            document.querySelector('form').submit();
        }

        document.querySelectorAll('.seat').forEach(seat => {
            seat.addEventListener('click', (event) => {
                const seatId = event.currentTarget.getAttribute('data-floor-seat-seq');
                updateSeat(seatId);
            });
        });
    </script>
</body>
</html>
